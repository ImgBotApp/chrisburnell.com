////
/// Code
/// @group components
////

/*code*/[data-lang] {
    padding-top: $spacing-large;
    line-height: 2;
    &:before {
        @include absolute;
        @include transition;
        content: attr(data-lang);
        background-color: $color-text-alt;
        color: $color-white;
        width: 100%;
        display: block;
        padding: 0 1.5rem;
        font-family: $font-stack-secondary;
        font-size: $font-size-large;
        font-weight: 600;
        line-height: $spacing-large;
        text-transform: uppercase;
        border-radius: $border-radius-default $border-radius-default 0 0;
    }
    @each $language in $coding-languages {
        $name:  nth($language, 1);
        $color: nth($language, 2);
        &.language-#{$name}:before {
            background-color: #{$color};
        }
    }
}

/**
 * Github-style Code Highlighting
 */
.highlight {
    position: relative;
    .err {                              // Error
        background-color: lightcoral;
        color: firebrick;
        font-weight: 600;
    }
    .c,                                 // Comment
    .cm,                                // Comment - Multiline
    .cp,                                // Comment - Preproc
    .c1,                                // Comment - Single
    .cs {                               // Comment - Special
        color: $color-text-alt;
        font-style: italic;
    }
    .gs,                                // Generic - Strong
    .k,                                 // Keyword
    .kc,                                // Keyword - Constant
    .kd,                                // Keyword - Declaration
    .kp,                                // Keyword - Pseudo
    .kr,                                // Keyword - Reserved
    .kt,                                // Keyword - Type
    .nc,                                // Name - Class
    .ne,                                // Name - Exception
    .nf,                                // Name - Function
    .o,                                 // Operator
    .ow {                               // Operator - Word
        font-weight: 600;
    }
    .gr,                                // Generic - Error
    .gt,                                // Generic - Traceback
    .ne,                                // Name - Exception
    .nf,                                // Name - Function
    .s,                                 // Literal - String
    .sb,                                // Literal - String Backtick
    .sc,                                // Literal - String Char
    .sd,                                // Literal - String Doc
    .s1,                                // Literal - String Single
    .s2,                                // Literal - String Double
    .se,                                // Literal - String Escape
    .sh,                                // Literal - String Heredoc
    .si,                                // Literal - String Interpol
    .sx {                               // Literal - String Other
        color: firebrick;
    }
    .gi,                                // Generic - Inserted
    .gi .x {                            // Generic - Inserted Specific
        background-color: turquoise;
    }
    .gd,                                // Generic - Deleted
    .gd .x {                            // Generic - Deleted Specific
        background-color: lightcoral;
    }
    .ge {                               // Generic - Emph
        font-style: italic;
    }
    .m,                                 // Literal - Number
    .il,                                // Literal - Number Integer Long
    .mf,                                // Literal - Number Float
    .mh,                                // Literal - Number Hex
    .mi,                                // Literal - Number Integer
    .mo,                                // Literal - Number Oct
    .nb,                                // Name - Builtin
    .no,                                // Name - Constant
    .nv,                                // Name - Variable
    .vc,                                // Name - Variable Class
    .vg,                                // Name - Variable Global
    .vi {                               // Name - Variable Instance
        color: cadetblue;
    }
    .sr {                               // Literal - String Regex
        color: forestgreen;
    }
    .bp,                                // Name - Builtin Pseudo
    .gh,                                // Generic - Heading
    .go,                                // Generic - Output
    .gp,                                // Generic - Prompt
    .nn {                               // Name - Namespace
        color: $color-text-alt;
    }
    .gu,                                // Generic - Subheading
    .w {                                // Text - Whitespace
        color: $color-text-light;
    }
    .kt,                                // Keyword - Type
    .na,                                // Name - Attribute
    .nc,                                // Name - Class
    .nt {                               // Name - Tag
        color: $color-brand;
    }
    .ni,                                // Name - Entity
    .ss {                               // Literal - String Symbol
        color: slateblue;
        color: rebeccapurple;
    }
}

/**
 * Code Block Visibility Toggling
 */
.code-toggle {
    position: relative;
}
.code-toggle-button {
    position: absolute;
    top: ($spacing-medium * 5); // center in the code block
    left: 50%;
    transform: translateX(-50%);
    &:active {
        transform: translateX(-50%) translateY(.182em);
    }
    .code-toggle-input:checked ~ & {
        display: none;
    }
}
.code-toggle-input {
    &:not(:checked) + .highlight pre {
        max-height: ($spacing-medium * 10); // limit to five lines of code
        overflow-x: hidden;
        &:after {
            @include absolute(bottom);
            content: "";
            background-image: gradient(transparent, $color-gray);
            height: ($spacing-medium * 4.2); // fade out over the last three lines
            display: block;
            border-radius: 0 0 $border-radius-default $border-radius-default;
        }
    }
    &:checked ~ .code-toggle-button {
        display: none;
    }
}
