/*!
 * A simple JSON search
 * @author  Mat Hayward - Erskine Design (Original Author)
 * @author  Chris Burnell <@iamchrisburnell>
 */
function initSearch(){getParameterByName("query")&&(query=decodeURIComponent(getParameterByName("query")).toLowerCase(),searchInput.value=query,execSearch(query)),query=searchInput.value,searchContainer&&searchForm.addEventListener?searchForm.addEventListener("submit",submitCallback,!1):searchContainer&&searchForm.attachEvent&&searchForm.attachEvent("onsubmit",submitCallback)}function submitCallback(e){e.preventDefault(),query=searchInput.value,query.length>=2&&query.length<=30?execSearch(query):resultsMeta.innerHTML="Your search query must be 2â€“30 characters in length."}function execSearch(e){(""!=e||allowEmpty)&&getSearchResults()}function getSearchResults(){var e=new XMLHttpRequest;e.open("GET",jsonFeedUrl,!0),e.onload=function(){if(e.status>=200&&e.status<400){var t=JSON.parse(e.responseText);processData(t)}},e.onerror=function(){},e.send()}function processData(e){for(var t,n,r,a,s,o,u=0,c="",l=0;l<e.length;l++)switch(t=e[l],query=query.toLowerCase(),n=t.title.toLowerCase().indexOf(query)>-1,r=!1,a=!1,s=!1,o=!1,t.introduction&&(r=t.introduction.toLowerCase().indexOf(query)>-1),t.content&&(a=t.content.toLowerCase().indexOf(query)>-1),t.categories&&(s=t.categories.toLowerCase().indexOf(query)>-1),t.tags&&(o=t.tags.toLowerCase().indexOf(query)>-1),t.type){case"page":(n||r||a)&&(u++,c+=populateResultContent(resultTemplatePage.innerHTML,t));break;case"article":(n||r||a||s||o)&&(u++,c+=populateResultContent(resultTemplateArticle.innerHTML,t));break;case"pen":(n||r||a||s||o)&&(u++,c+=populateResultContent(resultTemplatePen.innerHTML,t))}populateResultsString(u),showSearchResults(c)}function showSearchResults(e){resultsList.innerHTML=e}function populateResultContent(e,t){return e=injectContent(e,t.link,"@@url@@"),e=injectContent(e,t.title,"@@title@@"),e=injectContent(e,t.date,"@@date@@"),e=injectContent(e,t.date_friendly,"@@date_friendly@@"),t.introduction?e=injectContent(e,t.introduction,"@@introduction@@"):"pen"==t.type&&(e=injectContent(e,"<em>Featured Pen</em>","@@introduction@@")),e}function populateResultsString(e){var t=1==e?"s":"",n="<em>"+e+"</em> result"+t+" found for <q>"+query.toLowerCase()+"</q>";resultsMeta.innerHTML=n}function getParameterByName(e){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}function injectContent(e,t,n){var r=new RegExp(n,"g");return e.replace(r,t)}var query,jsonFeedUrl="../search.json",searchContainer=document.getElementById("search"),searchForm=document.getElementById("search-form"),searchInput=document.getElementById("search-input"),searchSubmit=document.getElementById("search-submit"),resultsMeta=document.getElementById("search-meta"),resultsList=document.getElementById("search-results-list"),resultTemplatePage=document.getElementById("search-template-page"),resultTemplateArticle=document.getElementById("search-template-article"),resultTemplatePen=document.getElementById("search-template-pen"),allowEmpty=!1;initSearch(),searchInput.disabled=!1,searchSubmit.disabled=!1;