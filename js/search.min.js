/*!
 * A simple JSON search
 * @author  Mat Hayward - Erskine Design (Original Author)
 * @author  Chris Burnell <@iamchrisburnell>
 */
function initSearch(){getParameterByName("query")&&(query=decodeURIComponent(getParameterByName("query")).toLowerCase(),searchInput.value=query,execSearch(query)),query=searchInput.value,searchContainer&&searchForm.addEventListener?searchForm.addEventListener("submit",submitCallback,!1):searchContainer&&searchForm.attachEvent&&searchForm.attachEvent("onsubmit",submitCallback)}function submitCallback(e){e.preventDefault(),query=searchInput.value,query.length>=2&&query.length<=30?execSearch(query):resultsMeta.innerHTML="Your search query must be 2â€“30 characters in length."}function execSearch(e){(""!=e||allowEmpty)&&getSearchResults()}function getSearchResults(){var e=new XMLHttpRequest;e.open("GET",jsonFeedUrl,!0),e.onload=function(){if(e.status>=200&&e.status<400){var t=JSON.parse(e.responseText);processData(t)}},e.onerror=function(){},e.send()}function processData(e){for(var t,n,r,a,s,o,c,u=0,l="",i=0;i<e.length;i++)switch(t=e[i],n=query.toLowerCase(),r=t.title.toLowerCase().indexOf(n)>-1,a=!1,s=!1,o=!1,c=!1,t.introduction&&(a=t.introduction.toLowerCase().indexOf(n)>-1),t.content&&(s=t.content.toLowerCase().indexOf(n)>-1),t.categories&&(o=t.categories.toLowerCase().indexOf(n)>-1),t.tags&&(c=t.tags.toLowerCase().indexOf(n)>-1),t.type){case"page":(r||a||s)&&(u++,l+=populateResultContent(resultTemplatePage.innerHTML,t));break;case"article":(r||a||s||o||c)&&(u++,l+=populateResultContent(resultTemplateArticle.innerHTML,t));break;case"pen":(r||a||s||o||c)&&(u++,l+=populateResultContent(resultTemplatePen.innerHTML,t))}populateResultsString(u),showSearchResults(l)}function showSearchResults(e){resultsList.innerHTML=e}function populateResultContent(e,t){return e=injectContent(e,t.link,"@@url@@"),e=injectContent(e,t.title,"@@title@@"),e=injectContent(e,t.date,"@@date@@"),e=injectContent(e,t.date_friendly,"@@date_friendly@@"),t.introduction?e=injectContent(e,t.introduction,"@@introduction@@"):t.categories.toLowerCase().indexOf("pen")>-1&&(e=injectContent(e,"<em>Featured Pen</em>","@@introduction@@")),e}function populateResultsString(e){var t=1==e?"s":"",n="<em>"+e+"</em> result"+t+" found for <q>"+query.toLowerCase()+"</q>";resultsMeta.innerHTML=n}function getParameterByName(e){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}function injectContent(e,t,n){var r=new RegExp(n,"g");return e.replace(r,t)}var query,jsonFeedUrl="../search.json",searchContainer=document.getElementById("search"),searchForm=document.getElementById("search-form"),searchInput=document.getElementById("search-input"),searchSubmit=document.getElementById("search-submit"),resultsMeta=document.getElementById("search-meta"),resultsList=document.getElementById("search-results-list"),resultTemplatePage=document.getElementsByClassName("search-template-page")[0],resultTemplateArticle=document.getElementsByClassName("search-template-article")[0],resultTemplatePen=document.getElementsByClassName("search-template-pen")[0],allowEmpty=!1;initSearch(),searchInput.disabled=!1,searchSubmit.disabled=!1;